<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>There and back again—how to preserve your data during transformations</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tinos:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../../../css/site.css">

  <!-- citation information -->
  <link rel="canonical" href="https://anthology.ach.org/volumes/vol0002/there-back-again-how-to-preserve-your-data-during/">
  <meta name="citation_title" content="There and back again—how to preserve your data during transformations">
  <meta name="citation_date" content="2025">
  <meta name="citation_public_url" content="https://anthology.ach.org/volumes/vol0002/there-back-again-how-to-preserve-your-data-during/">
  <meta name="citation_journal_title" content="Anthology of Computers and the Humanities">
  <meta name="citation_issn" content="">
  <meta name="citation_volume" content="2">
  <meta name="citation_firstpage" content="6">
  <meta name="citation_lastpage" content="12">
  <meta name="citation_doi" content="10.63744/GJCCSMz4QBbD">
  <meta name="citation_author" content="Casties, Robert">
  
  <meta name="citation_editor" content="Damerow, Julia">
  <meta name="citation_editor" content="Koeser, Rebecca Sutton">
  
  <meta name="citation_abstract" content="Abstract Datasets often need to be transformed—from an external file format into a database, from one database system into another, or from an outdated legacy system into an archive format. All transformations carry the risk of data corruption through software errors. What can software developers do to check data integrity and make sure that data is not lost or changed in the process? This paper presents three basic approaches with different degrees of accuracy and complexity, illustrated by real-world examples. The first example shows simple end-to-end statistics by counting entities during the import of a dataset into a database, the next more complex example shows bookkeeping of entities during the conversion of an HTML website, and the last a full round-trip migration and comparison of a project database and data model.">
  <meta name="citation_language" content="en">
  <meta name="citation_keywords" content="software; best practice; data integrity; digital humanities">
  <meta name="citation_fulltext_html_url" content="https://anthology.ach.org/volumes/vol0002/there-back-again-how-to-preserve-your-data-during/">
  <meta name="citation_pdf_url" content="https://anthology.ach.org/volumes/vol0002/there-back-again-how-to-preserve-your-data-during/10.63744@GJCCSMz4QBbD.pdf">

  <!-- Lightbox CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css" />

  <!-- Pandoc syntax highlighting CSS -->
  <link rel="stylesheet" href="../../../css/syntax-highlighting.css" />

  <style>
    /* Custom styles for better lightbox integration */
    figure {
      text-align: center;
      margin: 2em 0 3em 0;
    }

    figure img {
      cursor: pointer;
      transition: opacity 0.3s ease;
    }

    figure img:hover {
      opacity: 0.85;
    }

    figcaption {
      margin-top: 0.5em;
      font-style: italic;
      color: #666;
    }

    /* Table caption styling - match figure captions */
    table {
      caption-side: bottom;
    }

    table caption {
      margin-top: 0.5em;
      margin-bottom: 0;
      font-style: italic;
      color: #666;
    }

    /* Center wide tables in the viewport */
    div[id^="tab:"] {
      position: relative;
      left: 50%;
      transform: translateX(-50%);
      width: fit-content;
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
      margin-bottom: 2em;
    }

    /* Prevent text wrapping in table cells */
    div[id^="tab:"] table td,
    div[id^="tab:"] table th {
      white-space: nowrap;
    }

    /* Enhanced code block styles */
    .sourceCode {
      position: relative;
      background-color: #f5f5f5;
      border-radius: 6px;
      padding: 1em;
      margin: 1em 0;
      overflow-x: auto;
    }

    pre.sourceCode {
      margin: 0;
      padding: 0;
      background-color: transparent;
    }

    code.sourceCode {
      background-color: transparent;
      padding: 0;
    }

    /* Styles for code blocks wrapped in figures (auto-generated structure) */
    figure.float.listing {
      text-align: left;
      margin: 2em 0;
    }

    div.float-body.listing {
      position: relative;
      background-color: #f5f5f5;
      border-radius: 6px;
      padding: 1em;
      margin: 0;
      overflow-x: auto;
    }

    figure.float.listing pre {
      margin: 0;
      padding: 0;
      background-color: transparent;
      overflow: visible;
    }

    figure.float.listing code {
      background-color: transparent;
      padding: 0;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9em;
      line-height: 1.5;
    }

    /* Make sure syntax highlighting applies to code in figures */
    figure.float.listing pre > code {
      white-space: pre;
      position: relative;
    }

    /* Copy button styles */
    .code-copy-button {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 6px;
      background-color: #ffffff;
      border: 1px solid #d0d0d0;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      color: #333;
      transition: all 0.2s ease;
      z-index: 10;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      line-height: 1;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .code-copy-button:hover {
      background-color: #e8e8e8;
      border-color: #b0b0b0;
    }

    .code-copy-button:active {
      background-color: #d8d8d8;
    }

    .code-copy-button.copied {
      background-color: #4CAF50;
      color: white;
      border-color: #4CAF50;
    }

    .csl-entry {
      display: flex;
      align-items: flex-start;
      margin-bottom: 0.5em; /* optional: adds space between entries */
    }

    .csl-left-margin {
      width: 2.5em;       /* adjust for number width, e.g. [10] */
      flex-shrink: 0;     /* don’t let the number area shrink */
    }

    .csl-right-inline {
      flex: 1;
      padding-left: 0.5em;  /* small gap between number and text */
      text-indent: -0.5em;  /* hanging indent effect */
      margin-left: 0.5em;   /* pushes the block right a bit */
    }
  </style>


</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://ach.org">
        <img src="../../../logo/logo.png" alt="ACH Logo">
      </a>

      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div class="navbar-menu" id="navbarMain">
      <div class="navbar-start">
      </div>
      <div class="navbar-end">
        <a class="navbar-item" href="https://anthology.ach.org/">
          <b>Home</b>
        </a>
        <a class="navbar-item" href="https://anthology.ach.org/volumes/vol0001">
          <b>Volumes</b>
        </a>
        <a class="navbar-item" href="https://anthology.ach.org/about">
          <b>About</b>
        </a>
        <span style="width: 25px"></span>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-body">
      <div class="container">
        <p class="subtitle is-6 has-text-grey">Anthology of Computers and the Humanities · <a href="..">Volume 2</a></p>
        <h1 class="title paper-title">Undate in Action</h1>

        <div class="is-size-5 pl-7 has-text-centered">
          <a href="https://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;"><img style="height:25px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by.png"></a>
        </div>
      </div>

    </div>
  </section>

  <!-- Main Content -->
  <section class="section">
    <div class="container">

      <div class="paper-meta">
        <div class="authors-container">
          <div class="authors">
            <section class="authors-block">
              <p class="authors">
                  <span class="author">
                    Rebecca Sutton Koeser<sup></sup><a class="orcid-link" href="https://orcid.org/0000-0002-8762-8057" target="_blank" rel="noopener">
                        <img class="orcid" src="../../../data/orcid.png" alt="ORCID">
                      </a>
                  </span>
              </p>

              <ul class="affiliations">
                  <li><sup>1</sup> Center for Digital Humanities, Princeton University, Princeton, New Jersey, USA</li>
              </ul>
            </section>

          </div>
        </div>
      </div>


      <!-- Download Buttons -->
      <div class="buttons-container">
        <a href="10.63744@SFtXXpIE4ERh.pdf" class="button is-primary" target="_blank">
          <span class="icon">
            <i class="fas fa-file-pdf"></i>
          </span>
          <span>Download PDF</span>
        </a>
        <a href="10.63744@SFtXXpIE4ERh.bib" class="button is-info" target="_blank">
          <span class="icon">
            <i class="fas fa-file-code"></i>
          </span>
          <span>Download Citation</span>
        </a>
        
      </div>

      <!-- DOI -->
      <div class="doi-box">
        <p class="is-size-6">
          <b>Permanent Link:</b> <a class="doi-link" href="https://doi.org/10.63744/SFtXXpIE4ERh" target="_blank">https://doi.org/10.63744/SFtXXpIE4ERh</a>
        </p>
        <p class="is-size-6">
          <b>Published:</b> 17 October 2025
        </p>
      </div>

      <!-- Abstract -->
      <div class="content">
         <div class="abs">
<span>Abstract</span>
<p>This paper provides an introduction to the undate python library with
an emphasis on demonstrating supported functionality with some example
use cases from specific projects. undate is designed for working with
uncertain and partially known dates, and also includes support for dates
in multiple calendars and with mixed precision. This paper provides an
overview of the basic functionality with comparison to the Python
built-in datetime.date, demonstrating support for missing and partially
known values. Use cases and data from Princeton Geniza Project and
Shakespeare and Company Project are used to further demonstrate the
value and practical application of undate for parsing and comparing
mixed precision dates in multiple calendars, and for calculating and
plotting durations for events with known days but unknown years. This
paper was originally presented as a “tool presentation” at the Digital
Humanities Tech Symposium at DH2025.</p>
</div>
<h1 data-number="1" id="introduction"><span
class="header-section-number">1</span> Introduction</h1>
<p><code>undate</code> is a python library for working with uncertain or
partially known dates, with support for multiple calendars <span
class="citation" data-cites="koeser_undate_python_2025">[<a
href="#ref-koeser_undate_python_2025"
role="doc-biblioref">1</a>]</span>. It is “an ambitious in-progress
effort to develop a pragmatic Python package for the computation and
analysis of temporal information in humanistic and cultural data, with a
particular emphasis on uncertain, incomplete or imprecise dates and with
support for multiple calendaring systems and date formats” <span
class="citation" data-cites="koeser_undate_2025">[<a
href="#ref-koeser_undate_2025" role="doc-biblioref">2</a>]</span>. The
software is freely available on GitHub<a href="#fn1"
class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and
published under an open source software license. This project was
originally started at a DHTech Hackathon <span class="citation"
data-cites="koeser_join_2023">[<a href="#ref-koeser_join_2023"
role="doc-biblioref">3</a>]</span>, and builds on experiences from other
digital humanities projects. The ultimate goal is to build an active
community of people that are using and maintaining the project, and
developing it further.</p>
<figure id="fig:logo" data-latex-placement="h">
<a href="figures/undate_logo.png" data-lightbox="figures" data-title="Figure 1: undate project logo."><img
src="figures/undate_logo.png" style="width:40.0%" /></a>
<figcaption>Figure 1: <code>undate</code> project logo.</figcaption>
</figure>
<p>For an in-depth understanding of the context, goals, humanities and
software development methodologies that inform the project, and a
comparison with related software, I encourage you to read the software
paper “Undate: humanistic dates for computation” <span class="citation"
data-cites="koeser_undate_2025">[<a href="#ref-koeser_undate_2025"
role="doc-biblioref">2</a>]</span>. The logo (Figure
<a href="#fig:logo">1</a>) was designed as a reminder of the competing
needs for nuanced human-readable information and computationally
tractable data.</p>
<h2 data-number="1.1" id="sec:intro_details"><span
class="header-section-number">1.1</span> How is <code>Undate</code> like
<code>datetime.date</code>?</h2>
<p>Before describing <code>undate</code>’s functionality for handling
uncertain dates, first, as a point of reference, I demonstrate how it
compares with the standard Python <code>datetime.date</code>
implementation.</p>
<p>Both an <code>undate.Undate</code> and a <code>datetime.date</code>
can be initialized by specifying numeric values for year, month, and
day. Both can be printed using the default serialization (ISO8601, or
YYYY-MM-DD). <code>undate</code> is compatible with
<code>datetime.date</code>, so we can also can compare these two
objects. This means that <code>undate</code> can be easily used instead
of or in conjunction with <code>datetime.date</code>.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> undate <span class="im">import</span> Undate</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>year, month, day <span class="op">=</span> <span class="dv">2000</span>, <span class="dv">11</span>, <span class="dv">7</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># these are equivalent and we initialize them the same way</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>dt_november7 <span class="op">=</span> datetime.date(year, month, day)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>november7 <span class="op">=</span> Undate(year, month, day)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> november7 <span class="op">==</span> dt_november7</span></code></pre></div>
<h2 data-number="1.2" id="how-is-undate-not-like-datetime.date"><span
class="header-section-number">1.2</span> How is <code>Undate</code>
<em>not</em> like <code>datetime.date</code>?</h2>
<p>However, there are some key differences between the packages. An
<code>Undate</code> can be initialized with partial information.
<code>Undate</code> can also take an optional label, since sometimes
it’s useful to name a date. It can be initialized with year and month,
just year, or even month and day with no year.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># November 2000</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>november <span class="op">=</span> Undate(year, month, label<span class="op">=</span><span class="st">&quot;November 2000&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Year 2000</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>year2k <span class="op">=</span> Undate(year, label<span class="op">=</span><span class="st">&quot;Y2K&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># November 7 in an unknown year</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>november7_some_year <span class="op">=</span> Undate(month<span class="op">=</span>month, day<span class="op">=</span>day, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">&quot;Some November 7&quot;</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>november7.label <span class="op">=</span> <span class="st">&quot;November 7, 2000&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># sometimes names are important</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>easter1916 <span class="op">=</span> Undate(<span class="dv">1916</span>, <span class="dv">4</span>, <span class="dv">23</span>, label<span class="op">=</span><span class="st">&quot;Easter 1916&quot;</span>)</span></code></pre></div>
<p>If you try to do that with <code>datetime.date</code>, you get a
<code>TypeError</code> because all three fields are required.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    datetime.date(year, month)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> err:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(err)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;function missing required argument &#39;day&#39; (pos 3)&quot;</span></span></code></pre></div>
<p>Each of these <code>Undate</code> objects can be printed out in a
standard format; the <code>Undate</code> class also tracks how precisely
a date is specified, and can calculate the duration. If we iterate over
the example partially-known dates initialized in the code block above
and print label, formatted date, precision, and duration in days, we get
output like this (here and throughout, formatting has been added for
readability):</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> example_date <span class="kw">in</span> [</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    november,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    year2k,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    november7_some_year,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    november7,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    easter1916,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;&quot;&quot;</span><span class="sc">{</span>example_date<span class="sc">.</span>label<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>example_date<span class="sc">}</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- Date precision: </span><span class="sc">{</span>example_date<span class="sc">.</span>precision<span class="sc">}</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- Duration in days: </span><span class="sc">{</span>example_date<span class="sc">.</span>duration()<span class="sc">.</span>days<span class="sc">}</span><span class="ss">&quot;&quot;&quot;</span>)</span></code></pre></div>
<p> <strong>November 2000</strong> <code>2000-11</code></p>
<ul>
<li><p>Date precision: MONTH</p></li>
<li><p>Duration in days: 30</p></li>
</ul>
<p> <strong>Y2K</strong> <code>2000</code></p>
<ul>
<li><p>Date precision: YEAR</p></li>
<li><p>Duration in days: 366</p></li>
</ul>
<p> <strong>Some November 7</strong>
<code>-</code><code>-11-07</code></p>
<ul>
<li><p>Date precision: DAY</p></li>
<li><p>Duration in days: 1</p></li>
</ul>
<p> <strong>November 7, 2000</strong> <code>2000-11-07</code></p>
<ul>
<li><p>Date precision: DAY</p></li>
<li><p>Duration in days: 1</p></li>
</ul>
<p> <strong>Easter 1916</strong> <code>1916-04-23</code></p>
<ul>
<li><p>Date precision: DAY</p></li>
<li><p>Duration in days: 1</p></li>
</ul>
<p>We can also do some simple calculations, like checking whether one
date falls within another date.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> november <span class="kw">in</span> year2k   <span class="co"># 2000-11 in 2000</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> november7 <span class="kw">in</span> november  <span class="co"># 2000-11-07 in 2000-11</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> easter1916 <span class="kw">not</span> <span class="kw">in</span> year2k  <span class="co"># 1916-02-23 not in 2000</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> november7_some_year <span class="kw">not</span> <span class="kw">in</span> year2k  <span class="co"># --11-07 not in 2000</span></span></code></pre></div>
<h1 data-number="2" id="what-else-can-undate-do"><span
class="header-section-number">2</span> What else can <code>Undate</code>
do?</h1>
<h2 data-number="2.1" id="partially-known-values"><span
class="header-section-number">2.1</span> Partially known values</h2>
<p>In the last set of examples, the values used to initialize
<code>Undate</code> instances were all integers and parts of the date
were either known or unknown. But what if you know part of a date?</p>
<p>You can initialize <code>Undate</code> with strings and use
<strong><code>X</code></strong> to indicate unknown values. (We chose
<code>X</code> based on the <a
href="https://www.loc.gov/standards/datetime/">Extended Date Time Format
(EDTF)</a> specification).</p>
<p>Here we initialize two dates with partially known information, where
a year or month cannot be precisely pinned down but some information is
known. As before, we can iterate over these dates and output label,
formatted date, precision, and duration:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>someyear_1900s <span class="op">=</span> Undate(<span class="st">&quot;19XX&quot;</span>, label<span class="op">=</span><span class="st">&quot;1900s&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>late2022 <span class="op">=</span> Undate(<span class="dv">2022</span>, <span class="st">&quot;1X&quot;</span>, label<span class="op">=</span><span class="st">&quot;late 2022&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> example_date <span class="kw">in</span> [someyear_1900s, late2022]:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;&quot;&quot;</span><span class="sc">{</span>example_date<span class="sc">.</span>label<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>example_date<span class="sc">}</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ss">- Date precision: </span><span class="sc">{</span>example_date<span class="sc">.</span>precision<span class="sc">}</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ss">- Duration in days: </span><span class="sc">{</span><span class="bu">max</span>(example_date.duration().days)<span class="sc">}</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span>)</span></code></pre></div>
<p> <strong>1900s</strong> <code>19XX</code></p>
<ul>
<li><p>Date precision: YEAR</p></li>
<li><p>Duration in days: 366</p></li>
</ul>
<p> <strong>late 2022</strong> <code>2022-1X</code></p>
<ul>
<li><p>Date precision: MONTH</p></li>
<li><p>Duration in days: 31</p></li>
</ul>
<p>If you to initialize a <code>datetime.date</code> object like this,
you get another <code>TypeError</code>.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    datetime.date(<span class="st">&quot;19XX&quot;</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> err:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(err)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&#39;str&#39; object cannot be interpreted as an integer&quot;</span></span></code></pre></div>
<h2 data-number="2.2" id="uncertain-durations"><span
class="header-section-number">2.2</span> Uncertain durations</h2>
<p>If you were paying close attention, you may have noticed I used the
<code>max()</code> function in the code block above where I output the
duration for the partially known dates.</p>
<p>The most recent version of <code>undate</code> (version 0.5) includes
experimental support for uncertain time deltas. This is just one aspect
of support for working with dates and date ranges in terms of duration.
The <code>undate</code> package also includes an
<code>UndateInterval</code> class, with first-class support for date
ranges between two uncertain dates, or an open interval starting or
ending with an <code>Undate</code>. For reasons of space, I don’t
discuss the interval functionality in this paper.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;&quot;&quot;</span><span class="sc">{</span>someyear_1900s<span class="sc">.</span>label<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>someyear_1900s<span class="sc">}</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ss">- duration: </span><span class="sc">{</span>someyear_1900s<span class="sc">.</span>duration()<span class="sc">}</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ss">- duration in days: </span><span class="sc">{</span>someyear_1900s<span class="sc">.</span>duration()<span class="sc">.</span>days<span class="sc">}</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>late2022<span class="sc">.</span>label<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>late2022<span class="sc">}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ss">- duration: </span><span class="sc">{</span>late2022<span class="sc">.</span>duration()<span class="sc">}</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ss">- duration in days: </span><span class="sc">{</span>late2022<span class="sc">.</span>duration()<span class="sc">.</span>days<span class="sc">}</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span>)</span></code></pre></div>
<p> <strong>1900s</strong> <code>19XX</code></p>
<ul>
<li><p>duration: <code>UnDelta(days=[365,366])</code></p></li>
<li><p>duration in days:
<code>UnInt(lower=365, upper=366)</code></p></li>
</ul>
<p> <strong>late 2022</strong> <code>2022-1X</code></p>
<ul>
<li><p>duration: <code>UnDelta(days=[30,31])</code></p></li>
<li><p>duration in days: <code>UnInt(lower=30, upper=31)</code></p></li>
</ul>
<p>Even without precise information, we can still do some useful
comparisons. February of an unknown year is still shorter than October,
November, or December.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>some_february <span class="op">=</span> Undate(month<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&quot;February of some year&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># February of an unknown year is shorter than </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># an uncertain month 1X (October, November, or December) </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> some_february.duration() <span class="op">&lt;</span> late2022.duration()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;&quot;&quot;</span><span class="sc">{</span>some_february<span class="sc">.</span>label<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>some_february<span class="sc">}</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ss">- duration: </span><span class="sc">{</span>some_february<span class="sc">.</span>duration()<span class="sc">}</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ss">- duration in days: </span><span class="sc">{</span>some_february<span class="sc">.</span>duration()<span class="sc">.</span>days<span class="sc">}</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span>)</span></code></pre></div>
<p> <strong>February of some year</strong>
<span><code>-</code></span><span><code>-02</code></span></p>
<ul>
<li><p>duration: <code>UnDelta(days=[28,29])</code></p></li>
<li><p>duration in days: <code>UnInt(lower=28, upper=29)</code></p></li>
</ul>
<h1 data-number="3" id="example-use-cases-from-specific-projects"><span
class="header-section-number">3</span> Example use cases from specific
projects</h1>
<p><code>undate</code> is informed by work from existing digital
humanities projects, and has been developed with the goal of
generalizing custom solutions into a reusable library to benefit the
whole community. In particular, “<code>undate</code> draws on a partial
date implementation from the <em>Shakespeare and Company Project</em>
and calendar conversion and mixed precision dates in the <em>Princeton
Geniza Project</em> (PGP). Calendar logic and representation is
additionally informed by work on the <em>Islamic Scientific Manuscripts
Initiative</em> (ISMI)” <span class="citation"
data-cites="koeser_undate_2025">[<a href="#ref-koeser_undate_2025"
role="doc-biblioref">2</a>]</span>.</p>
<h2 data-number="3.1" id="princeton-geniza-project"><span
class="header-section-number">3.1</span> Princeton Geniza Project</h2>
<p>The <a href="https://geniza.princeton.edu/"><em>Princeton Geniza
Project</em></a> (PGP) is a long-running project focused on materials
from a synagogue in Cairo; these contents are primarily medieval, and
largely written in Hebrew script. Because they are older and
fragmentary, many of them cannot be dated; those documents that do have
dates use a variety of calendars — the Hebrew <em>Anno Mundi</em> and
Seleucid calendars, as well as the Islamic <em>Hijri</em> calendar. The
Hebrew calendar is a lunisolar calendar and the Islamic calendar is a
lunar calendar, so they don’t map neatly to the months and years of the
Gregorian calendar.</p>
<p>The PGP is one of the precursors that fed into the development of
<code>undate</code>, due to this need to support storing, filtering, and
searching dates from multiple calendars, with mixed precision, and
various kinds of temporal uncertainty <span class="citation"
data-cites="rustow_dating_2020">[<a href="#ref-rustow_dating_2020"
role="doc-biblioref">4</a>]</span>. Here, I use data from the published
PGP datasets <span class="citation"
data-cites="rustow_princeton_2025">[<a href="#ref-rustow_princeton_2025"
role="doc-biblioref">5</a>]</span> to demonstrate <code>undate</code>
calendar parsing and conversion functionality.</p>
<p>An <code>Undate</code> instance preserves any initial values for
year, month, and day in the original calendar. As you see in Table
<a href="#tab:pgp-parsed-dates">1</a>, the ISO format
<code>Undate</code> corresponds to the original date rather than the
standardized date.</p>
<div id="tab:pgp-parsed-dates">
<table>
<caption>Table 1: A sampling of dates from PGP documents in different
calendars; dates have been parsed by <code>Undate</code>, which was then
used to report precision and weekday.</caption>
<thead>
<tr>
<th style="text-align: right;">Original Date</th>
<th style="text-align: left;">Calendar</th>
<th style="text-align: left;">Standard date</th>
<th style="text-align: left;"><code>Undate</code></th>
<th style="text-align: left;">Precision</th>
<th style="text-align: left;">Weekday</th>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"></td>
<td style="text-align: left;">Seleucid</td>
<td style="text-align: left;">1259</td>
<td style="text-align: left;">1570</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">Tammuz 1288</td>
<td style="text-align: left;">Seleucid</td>
<td style="text-align: left;">0977-06-21/0977-07-19</td>
<td style="text-align: left;">1288-04</td>
<td style="text-align: left;">month</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">19 Adar 1427</td>
<td style="text-align: left;">Seleucid</td>
<td style="text-align: left;">1116-03-05</td>
<td style="text-align: left;">1427-12-19</td>
<td style="text-align: left;">day</td>
<td style="text-align: left;">Sunday</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">4890</td>
<td style="text-align: left;">Anno Mundi</td>
<td style="text-align: left;">1129-09-16/1130-09-05</td>
<td style="text-align: left;">4890</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">Av 5564</td>
<td style="text-align: left;">Anno Mundi</td>
<td style="text-align: left;">1804-07-09/1804-08-07</td>
<td style="text-align: left;">5564-05</td>
<td style="text-align: left;">month</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">10 Nisan 4716</td>
<td style="text-align: left;">Anno Mundi</td>
<td style="text-align: left;">0956-03-24</td>
<td style="text-align: left;">4716-01-10</td>
<td style="text-align: left;">day</td>
<td style="text-align: left;">Monday</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">537</td>
<td style="text-align: left;">Hijrī</td>
<td style="text-align: left;">1142-07-27/1143-07-15</td>
<td style="text-align: left;">0537</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">Shawwāl 425</td>
<td style="text-align: left;">Hijrī</td>
<td style="text-align: left;">1034-08-29/1034-09-07</td>
<td style="text-align: left;">0425-10</td>
<td style="text-align: left;">month</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">5 Safar 584</td>
<td style="text-align: left;">Hijrī</td>
<td style="text-align: left;">1188-04-05</td>
<td style="text-align: left;">0584-02-05</td>
<td style="text-align: left;">day</td>
<td style="text-align: left;">Tuesday</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<p>Under the hood, <code>undate</code> calculates the earliest and
latest possible dates in range for comparison and sorting. When an
<code>Undate</code> object is initialized with a different calendar, the
earliest and latest dates are based on conversion to the Gregorian
calendar so that dates can be compared and used together across
calendars. (The code used to parse the PGP document dates displayed in
this example is available in Appendix ). When working across calendars,
dates with the same precision (year, month) often have different
durations in days.</p>
<p>An <code>Undate</code> object is aware of date precision, which means
that in a dataset with mixed precision dates like PGP, once dates are
parsed we can easily see the variation in the data (Table ).<a
href="#fn2" class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a></p>
<table>
<caption>Table 2: Totals for PGP documents and date precision</caption>
<thead>
<tr>
<th style="text-align: center;">Original Date precision</th>
<th style="text-align: center;">Documents</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">year</td>
<td style="text-align: center;">831</td>
</tr>
<tr>
<td style="text-align: center;">month</td>
<td style="text-align: center;">1,021</td>
</tr>
<tr>
<td style="text-align: center;">day</td>
<td style="text-align: center;">1,558</td>
</tr>
</tbody>
</table>
<p>Only includes documents with standard dates that can be parsed by
<code>undate</code>. </p>
<div id="tab:pgp-date-durations">
<table>
<caption>Table 3: Another sampling of dates from PGP documents in
different calendars parsed by <code>Undate</code>. Earliest and latest
dates are calculated in Gregorian / proleptic Gregorian calendar.
Semantic durations like year and month result in different durations in
days when working with multiple calendars.</caption>
<thead>
<tr>
<th style="text-align: right;">Original Date</th>
<th style="text-align: left;">Calendar</th>
<th style="text-align: left;"><code>Undate</code></th>
<th style="text-align: left;">Earliest</th>
<th style="text-align: left;">Latest</th>
<th style="text-align: left;">Precision</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">1570</td>
<td style="text-align: left;">Seleucid</td>
<td style="text-align: left;">1570</td>
<td style="text-align: left;">1258-09-07</td>
<td style="text-align: left;">1259-09-26</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;">383</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">1474</td>
<td style="text-align: left;">Seleucid</td>
<td style="text-align: left;">1474</td>
<td style="text-align: left;">1162-09-18</td>
<td style="text-align: left;">1163-09-06</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;">354</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">Tevet 1363</td>
<td style="text-align: left;">Seleucid</td>
<td style="text-align: left;">1363-10</td>
<td style="text-align: left;">1051-12-14</td>
<td style="text-align: left;">1052-01-11</td>
<td style="text-align: left;">month</td>
<td style="text-align: left;">29</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;"><span>[12]91</span></td>
<td style="text-align: left;">Seleucid</td>
<td style="text-align: left;">1291</td>
<td style="text-align: left;">0979-09-30</td>
<td style="text-align: left;">0980-09-17</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;">353</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">Heshvan 1453</td>
<td style="text-align: left;">Seleucid</td>
<td style="text-align: left;">1453-08</td>
<td style="text-align: left;">1141-10-11</td>
<td style="text-align: left;">1141-11-08</td>
<td style="text-align: left;">month</td>
<td style="text-align: left;">29</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">1347</td>
<td style="text-align: left;">Seleucid</td>
<td style="text-align: left;">1347</td>
<td style="text-align: left;">1035-09-12</td>
<td style="text-align: left;">1036-09-28</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;">383</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">Shevat (4)791</td>
<td style="text-align: left;">Anno Mundi</td>
<td style="text-align: left;">4791-11</td>
<td style="text-align: left;">1031-01-03</td>
<td style="text-align: left;">1031-02-01</td>
<td style="text-align: left;">month</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">4812</td>
<td style="text-align: left;">Anno Mundi</td>
<td style="text-align: left;">4812</td>
<td style="text-align: left;">1051-09-15</td>
<td style="text-align: left;">1052-09-03</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;">385</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">502</td>
<td style="text-align: left;">Hijrī</td>
<td style="text-align: left;">0502</td>
<td style="text-align: left;">1108-08-18</td>
<td style="text-align: left;">1109-08-06</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;">354</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">Muḥarram 557</td>
<td style="text-align: left;">Hijrī</td>
<td style="text-align: left;">0557-01</td>
<td style="text-align: left;">1161-12-28</td>
<td style="text-align: left;">1162-01-26</td>
<td style="text-align: left;">month</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;">Safar 1248</td>
<td style="text-align: left;">Hijrī</td>
<td style="text-align: left;">1248-02</td>
<td style="text-align: left;">1832-06-30</td>
<td style="text-align: left;">1832-07-28</td>
<td style="text-align: left;">month</td>
<td style="text-align: left;">29</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<p>Preserving available details in mixed precision dates offers new
opportunities for analysis; for instance, we can analyze weekday
frequency by document type (Figure
<a href="#fig:pgp-weekday-frequency">2</a>). In the PGP data, Legal
documents and letters are the types of documents most likely to have a
clear date. When visualized with a heatmap, the results match our
expectations: Saturday is light for both types, because it is the Hebrew
Shabbat, a day of rest. Monday and Thursday are the traditional
convening days for court sessions, which is reflected in the
preponderance of Legal documents on those days.<a href="#fn3"
class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<figure id="fig:pgp-weekday-frequency" data-latex-placement="h">
<a href="figures/pgp_letters_legaldocs_weekday.png" data-lightbox="figures" data-title="Figure 2: Legal documents and letters frequency by weekday. "><img
src="figures/pgp_letters_legaldocs_weekday.png"
style="width:40.0%" /></a>
<figcaption>Figure 2: Legal documents and letters frequency by weekday.
</figcaption>
</figure>
<h2 data-number="3.2" id="shakespeare-and-company-project"><span
class="header-section-number">3.2</span> Shakespeare and Company
Project</h2>
<p>The <a href="https://shakespeareandco.princeton.edu/"><em>Shakespeare
and Company Project</em></a> is based on the materials from Sylvia
Beach’s famous English-language lending library that operated in Paris
in the 1920s and 1930s. This project is one of the precursors that fed
into the development of <code>undate</code>, with an implementation to
support incomplete dates written on handwritten cards <span
class="citation"
data-cites="kotin_shakespeare_2022 koeser_coding_2019">[<a
href="#ref-koeser_coding_2019" role="doc-biblioref">7</a>,<a
href="#ref-kotin_shakespeare_2022"
role="doc-biblioref">6</a>]</span>.</p>
<figure id="fig:stein-lending-card" data-latex-placement="h">
<a href="figures/stein_lendingcard_unknownyear.jpg" data-lightbox="figures" data-title="Figure 3: Detail from Gertrude Stein’s lending library card showing handwritten borrow events with no year. [@stein_beachpapers_pul; @noauthor_gertrude_nodate] "><img
src="figures/stein_lendingcard_unknownyear.jpg"
style="width:70.0%" /></a>
<figcaption>Figure 3: Detail from Gertrude Stein’s lending library card
showing handwritten borrow events with no year. <span class="citation"
data-cites="stein_beachpapers_pul noauthor_gertrude_nodate">[<a
href="#ref-stein_beachpapers_pul" role="doc-biblioref">8</a>,<a
href="#ref-noauthor_gertrude_nodate" role="doc-biblioref">9</a>]</span>
</figcaption>
</figure>
<div id="tab:stein-borrowing">
<table>
<caption>Table 4: Sample borrowing activity for Gertrude Stein at the
Shakespeare and Company lending library in Paris, including borrow
events with unknown years but calculable durations.</caption>
<thead>
<tr>
<th style="text-align: left;">Start Date</th>
<th style="text-align: left;">End Date</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: right;">Title</th>
<th style="text-align: left;">Author</th>
<th style="text-align: left;"></th>
<th style="text-align: right;"></th>
<th style="text-align: right;"></th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">–01-19</td>
<td style="text-align: left;">–01-24</td>
<td style="text-align: left;">5</td>
<td style="text-align: right;"><em>A Hazard of New Fortunes</em></td>
<td style="text-align: left;">Howells, William Dean</td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">–01-24</td>
<td style="text-align: left;">–05-30</td>
<td style="text-align: left;">126</td>
<td style="text-align: right;"><em>Boston Cooking-School Cook
Book</em></td>
<td style="text-align: left;">Farmer, Fannie Merritt</td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">–01-24</td>
<td style="text-align: left;">–03-20</td>
<td style="text-align: left;">55</td>
<td style="text-align: right;"><em>The Landlord at Lion’s Head</em></td>
<td style="text-align: left;">Howells, William Dean</td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">–01-24</td>
<td style="text-align: left;">–05-30</td>
<td style="text-align: left;">126</td>
<td style="text-align: right;"><em>Mrs. Rorer’s New Cook Book</em></td>
<td style="text-align: left;">Rorer, Sarah Tyson</td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">–01-24</td>
<td style="text-align: left;">–03-20</td>
<td style="text-align: left;">55</td>
<td style="text-align: right;"><em>Indian Summer</em></td>
<td style="text-align: left;">Howells, William Dean</td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">–01-24</td>
<td style="text-align: left;">–03-20</td>
<td style="text-align: left;">55</td>
<td style="text-align: right;"><em>A Foregone Conclusion</em></td>
<td style="text-align: left;">Howells, William Dean</td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">–01-24</td>
<td style="text-align: left;">–03-20</td>
<td style="text-align: left;">55</td>
<td style="text-align: right;"><em>Dr. Breen’s Practice</em></td>
<td style="text-align: left;">Howells, William Dean</td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">1920-04-29</td>
<td style="text-align: left;">1920-06-03</td>
<td style="text-align: left;">35</td>
<td style="text-align: right;"><em>The Letters of George
Meredith</em></td>
<td style="text-align: left;">Meredith, George</td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<p>This project includes borrowing events with unknown years; with
<code>undate</code> we can calculate how long a book was borrowed even
when we don’t know the exact year. We use Gertrude Stein as an example
here, since she is a well known figure with documented borrowing
activity without known years (Figure
<a href="#fig:stein-lending-card">3</a>), although she is far from the
only one.<a href="#fn4" class="footnote-ref" id="fnref4"
role="doc-noteref"><sup>4</sup></a> Stein has 46 borrow events with
calculable duration; of those 7, or 15%, have no known year. If we limit
our analysis to borrow events with known years, we arrive at an average
borrow length of 32 days and a maximum of 91 days. However, when we
include events with unknown years we get an average of 38 and a maximum
of 126 days. In the context of this project, we calculate the duration
of borrow events with unknown years as the shortest possible duration
between the start and end date; that is, the the dates are in the same
year (or following year, when the end date is an earlier month than the
start date). This is based on our assumption that the clerks working in
the book shop would have noted the year if the book was out for a longer
time period, as they did in other cases.</p>
<p>The full code used to calculate durations and plot them is available
in Appendix . Here we show a sample of the parsed borrow events (Table
<a href="#tab:stein-borrowing">3</a>) and a raincloud plot of Stein’s
borrowing (Figure <a href="#fig:stein-borrow-raincloud">4</a>) to
demonstrate the value of including partial information in our analysis.
As you can see, leaving out partially known dates would greatly change
the distribution.</p>
<figure id="fig:stein-borrow-raincloud" data-latex-placement="t!">
<a href="figures/shxco_stein_borrows.png" data-lightbox="figures" data-title="Figure 4: Raincloud plot showing how long Gertrude Stein typically kept the books she borrowed. Borrows with unknown years are highlighted in orange in the lower portion (the “rain”) of the plot. "><img
src="figures/shxco_stein_borrows.png" /></a>
<figcaption>Figure 4: Raincloud plot showing how long Gertrude Stein
typically kept the books she borrowed. Borrows with unknown years are
highlighted in orange in the lower portion (the “rain”) of the plot.
</figcaption>
</figure>
<h1 data-number="4" id="conclusion"><span
class="header-section-number">4</span> Conclusion</h1>
<p>This paper provides a demonstration of some of the current
functionality of the <code>undate</code> python library, although it is
certainly not exhaustive. I have barely touched on intervals and some of
the calculations and logic around uncertainty that are currently
supported. This package is still in active development, with tremendous
potential in multiple directions. I and my collaborators plan to
continue adding support for more calendars and formats (e.g., RDF and
CIDOC-CRM), and improve the support for ambiguity and granularity in
parsing and date precisions. Other avenues of interest are representing
the temporal uncertainty in data visualizations based on
<code>undate</code> parsing and analysis <span class="citation"
data-cites="yau_visualizing_2018">[<a href="#ref-yau_visualizing_2018"
role="doc-biblioref">10</a>]</span>, or making more use of labels for
analysis. Development on <code>undate</code> input and use cases from
the community to steer and prioritize the work, to ensure that work is
interpretable and usable in the context of a specific project while
still being general enough to be usable and accurate across disparate
projects. As <code>undate</code> matures, I hope to start seeing it used
in more projects, and we would love to know if there is an interest or
need in adapting it to other programming languages or extending it for
specific ecosystems and frameworks.</p>
<h1 class="unnumbered" id="acknowledgements">Acknowledgements</h1>
<p>This work is supported by the Center for Digital Humanities at
Princeton University. Thanks to my reviewers, especially: David Ragnar
Nelson, who caught and corrected several errors in the code examples
introduced in the conversion from notebook to paper; and Julia Damerow,
for suggestions to improve the flow.</p>
<h1 class="unnumbered" data-number="A" id="appdx:parse-pgp-dates"><span
class="header-section-number">A</span> Parsing PGP document dates in
multiple calendars</h1>
<p>Princeton Geniza Project data includes documents with original dates
in multiple calendars. <code>undate</code> does not yet provide an
omnibus parser, so dates must be parsed according to their a known,
supported calendar. The dates in this dataset are complicated and messy,
and include qualifiers and uncertainty not yet supported by
<code>undat</code>e parsing. For demonstration purposes, this example
code removes and ignores those complexities.</p>
<p>Adapted from an <a
href="https://github.com/dh-tech/undate-python/blob/main/examples/pgp_dates.ipynb">example
notebook</a> included in the <code>undate</code> software
repository.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lark.exceptions <span class="im">import</span> UnexpectedEOF</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lark.visitors <span class="im">import</span> VisitError</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># set this to True to see details about parsing</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>VERBOSE_PARSE_OUTPUT <span class="op">=</span> <span class="va">False</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_ordinals(val):</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># utility method to turn ordinals into numerals</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i.e., 1st, 2nd, 3rd -&gt; 1, 2, 3</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> re.sub(<span class="vs">r&quot;</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)(</span><span class="vs">st</span><span class="cf">|</span><span class="vs">nd</span><span class="cf">|</span><span class="vs">rd</span><span class="cf">|</span><span class="vs">th</span><span class="kw">)</span><span class="vs">&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&quot;</span>, val)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_original_date(doc_date_original, doc_date_calendar):</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map PGP original calendar to undate calendar converter</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    undate_calendar <span class="op">=</span> <span class="va">None</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> doc_date_calendar <span class="op">==</span> <span class="st">&quot;Anno Mundi&quot;</span>:</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        undate_calendar <span class="op">=</span> <span class="st">&quot;Hebrew&quot;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> doc_date_calendar <span class="op">==</span> <span class="st">&quot;Hijrī&quot;</span>:</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        undate_calendar <span class="op">=</span> <span class="st">&quot;Islamic&quot;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> doc_date_calendar <span class="op">==</span> <span class="st">&quot;Seleucid&quot;</span>:</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        undate_calendar <span class="op">=</span> <span class="st">&quot;Seleucid&quot;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> undate_calendar:</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> doc_date_original</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># some dates have unknown digits, e.g. 1[.] Kislev 48[..] or 152[.]</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Replace with zeros for now, since the calendar parsers</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># doesn&#39;t yet support this syntax</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># (even though Undate supports unknown digits)</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;[.&quot;</span> <span class="kw">in</span> value:</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> VERBOSE_PARSE_OUTPUT:</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;ignoring missing digits for now </span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>            value <span class="op">=</span> (</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>                value.replace(<span class="st">&quot;[.]&quot;</span>, <span class="st">&quot;0&quot;</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>                .replace(<span class="st">&quot;[..]&quot;</span>, <span class="st">&quot;00&quot;</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>                .replace(<span class="st">&quot;[...]&quot;</span>, <span class="st">&quot;000&quot;</span>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># some dates have inferred numbers, </span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e.g. Friday, [25] Nisan [4810] or 8 Elul (4)811&#39;</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for now, we strip out brackets before parsing;</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># in future, we could indicate uncertainty based on these</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> (</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>            value.replace(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>            .replace(<span class="st">&quot;]&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>            .replace(<span class="st">&quot;(&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>            .replace(<span class="st">&quot;)&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for now, remove modifiers not supported by the undate parser:</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   Late Tevet 4903, Last decade of Kislev 5004, first third of ...</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>        modifiers <span class="op">=</span> [</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Late &quot;</span>,</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;(first|middle|last)( third|half|decade|tenth)? (of )?&quot;</span>,</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;(Beginning|end) of &quot;</span>,</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;last day&quot;</span>,</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;First 10 days&quot;</span>,</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot; of&quot;</span>,</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;spring&quot;</span>,</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;decade &quot;</span>,</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;night, &quot;</span>,</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> mod <span class="kw">in</span> modifiers:</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>            value <span class="op">=</span> re.sub(mod, <span class="st">&quot;&quot;</span>, value, flags<span class="op">=</span>re.I)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># about 62 have ordinals; strip them out</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> remove_ordinals(value)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># parse the simplified, cleaned up date string </span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>        <span class="co"># with the specified calendar</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> Undate.parse(value, undate_calendar)</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (VisitError, <span class="pp">ValueError</span>, UnexpectedEOF) <span class="im">as</span> err:</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> VERBOSE_PARSE_OUTPUT:</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Parse error : </span><span class="sc">{</span>value<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>undate_calendar<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>err<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Polars to load data file into a DataFrame</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to documents with standard dates</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>pgp_documents_df <span class="op">=</span> pl.read_csv(<span class="st">&quot;pgp_documents.csv&quot;</span>) \     </span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">&quot;doc_date_standard&quot;</span>).is_not_null()</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a struct of original date and calendar,</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="co"># which we can pass to our parse method.</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="co"># If parsing succeeds, returns and Undate or UndateInterval</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>pgp_documents_df <span class="op">=</span> pgp_documents_df.with_columns(</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>    undate_orig<span class="op">=</span>pl.struct(</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;doc_date_original&quot;</span>, <span class="st">&quot;doc_date_calendar&quot;</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>    ).map_elements(</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> row: parse_original_date(</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">&quot;doc_date_original&quot;</span>], row[<span class="st">&quot;doc_date_calendar&quot;</span>]</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>        return_dtype<span class="op">=</span>pl.datatypes.Object,</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>days <span class="op">=</span> [</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Monday&quot;</span>,</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Tuesday&quot;</span>,</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Wednesday&quot;</span>,</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Thursday&quot;</span>,</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Friday&quot;</span>,</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Saturday&quot;</span>,</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Sunday&quot;</span>,</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to records that were successfully parsed; </span></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="co"># determine weekday for use with day-level precision dates</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>pgp_documents_df <span class="op">=</span> (</span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>    pgp_documents_df.<span class="bu">filter</span>(pl.col(<span class="st">&quot;undate_orig&quot;</span>).is_not_null())</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">&quot;type&quot;</span>).fill_null(<span class="st">&quot;Unknown&quot;</span>),  <span class="co"># set null type to unknown</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>        orig_date_precision<span class="op">=</span>pl.col(<span class="st">&quot;undate_orig&quot;</span>).map_elements(</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lambda</span> x: <span class="bu">str</span>(x.precision).lower(),</span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>            return_dtype<span class="op">=</span>pl.datatypes.String,</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>        undate_weekday<span class="op">=</span>pl.col(<span class="st">&quot;undate_orig&quot;</span>).map_elements(</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lambda</span> x: x.earliest.weekday, return_dtype<span class="op">=</span>pl.datatypes.Int32</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>        undate_weekday_name<span class="op">=</span>pl.col(<span class="st">&quot;undate_weekday&quot;</span>).map_elements(</span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lambda</span> x: days[x], return_dtype<span class="op">=</span>pl.datatypes.String</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to relevant fields and display the first ten rows</span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>pgp_documents_df.select(</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;pgpid&quot;</span>,</span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;type&quot;</span>,</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;doc_date_original&quot;</span>,</span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;doc_date_calendar&quot;</span>,</span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;doc_date_standard&quot;</span>,</span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;undate_orig&quot;</span>,</span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;orig_date_precision&quot;</span>,</span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;undate_weekday_name&quot;</span>,</span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>).head(<span class="dv">10</span>)    </span></code></pre></div>
<h1 class="unnumbered" data-number="B"
id="appdx:shxco-duration-raincloud"><span
class="header-section-number">B</span> Determine and plot durations for
Shakespeare and Company Project borrowing</h1>
<p>This project includes borrowing events with unknown years; with
<code>undate</code> we can calculate how long a book was borrowed even
when we don’t know the year.</p>
<p>First we define a couple of methods that we’ll use with the data:</p>
<ul>
<li><p><code>undate_duration</code> to parse the dates and calculate
duration in days</p></li>
<li><p><code>known_year</code> to provide an indicator for whether the
year was known, which we’ll use when plotting the data</p></li>
</ul>
<p>We load the full events data from the Shakespeare and Company
published datasets <span class="citation"
data-cites="koeser_shakespeare_2025">[<a
href="#ref-koeser_shakespeare_2025" role="doc-biblioref">11</a>]</span>
and filter it to borrow events for Gertrude Stein based on
<code>event_type</code> and <code>member_ids</code>. Then we use the
custom methods defined first to calculate borrow durations and add a
variable indicating whether the year is known.</p>
<p>Finally, we define and use a method to generate a raincloud plot,
showing the distribution of borrow durations in two different ways, and
color the rain drops in the lower portion of the plot to highlight the
durations based on borrow events with unknown years. (The raincloud plot
is adapted from prior work in <span class="citation"
data-cites="koeser_missing_2024">[<a href="#ref-koeser_missing_2024"
role="doc-biblioref">12</a>]</span>.)</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> undate <span class="im">import</span> UndateInterval</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> undate.date <span class="im">import</span> ONE_DAY, UnInt</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> undate.converters.iso8601 <span class="im">import</span> ISO8601DateFormat</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> undate_duration(start_date, end_date):</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    isoformat <span class="op">=</span> ISO8601DateFormat()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    unstart <span class="op">=</span> isoformat.parse(start_date)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    unend <span class="op">=</span> isoformat.parse(end_date)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    interval <span class="op">=</span> UndateInterval(earliest<span class="op">=</span>unstart, latest<span class="op">=</span>unend)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># borrow durations in Shakespeare and Company Project were defined as</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># not including both ends (or half of the day on both ends);</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to reconcile differences between duration logic with undate, </span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># which includes both endpoints, we subtract one day</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (interval.duration() <span class="op">-</span> ONE_DAY).days</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> known_year(date):</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;known&quot;</span> <span class="cf">if</span> ISO8601DateFormat().parse(date).known_year <span class="cf">else</span> <span class="st">&quot;unknown&quot;</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>stein_borrow_events_df <span class="op">=</span> (</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    pl.read_csv(<span class="st">&quot;SCoData_events_v2.0_2025.csv&quot;</span>, infer_schema_length<span class="op">=</span><span class="dv">10000</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">&quot;member_ids&quot;</span>).eq(<span class="st">&quot;stein-gertrude&quot;</span>),</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">&quot;event_type&quot;</span>).eq(<span class="st">&quot;Borrow&quot;</span>),</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for simplicity, we&#39;re going to limit to events that Project</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># provides a borrow duration for; this indicates</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the duration is calculable (i.e., start and end dates known)</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">&quot;borrow_duration_days&quot;</span>).is_not_null(),</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;event_type&quot;</span>,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;start_date&quot;</span>,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;end_date&quot;</span>,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;borrow_duration_days&quot;</span>,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;item_title&quot;</span>,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;item_authors&quot;</span>,</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;item_year&quot;</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate durations; returns a dataframe with one column</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>duration_df <span class="op">=</span> stein_borrow_events_df.select(<span class="st">&quot;start_date&quot;</span>, <span class="st">&quot;end_date&quot;</span>).map_rows(</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: undate_duration(x[<span class="dv">0</span>], x[<span class="dv">1</span>]), return_dtype<span class="op">=</span>pl.datatypes.Int32</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="co"># add fields to the main dataframe for duration and whether year is known</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>stein_borrow_events_df <span class="op">=</span> stein_borrow_events_df.with_columns(</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    undate_duration<span class="op">=</span>duration_df[<span class="st">&quot;map&quot;</span>],</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    known_year<span class="op">=</span>stein_borrow_events_df[<span class="st">&quot;start_date&quot;</span>].map_elements(</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>        known_year, return_dtype<span class="op">=</span>pl.datatypes.String</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> raincloud_plot(dataset, fieldname, field_label, color_opts<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Create a raincloud plot for the density of the specified field</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a><span class="co">    in the given dataset. Takes an optional tooltip for the strip plot.</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns an altair chart.&quot;&quot;&quot;</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create a density area plot of specified fieldname</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>    duration_density <span class="op">=</span> (</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>        alt.Chart(dataset)</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>        .transform_density(</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>            fieldname,</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>            as_<span class="op">=</span>[fieldname, <span class="st">&quot;density&quot;</span>],</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>        .mark_area(orient<span class="op">=</span><span class="st">&quot;vertical&quot;</span>)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>        .encode(</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>alt.X(</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>                fieldname, title<span class="op">=</span><span class="va">None</span>, axis<span class="op">=</span>alt.X(labels<span class="op">=</span><span class="va">False</span>, ticks<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>alt.Y(</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;density:Q&quot;</span>,</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>                <span class="co"># suppress labels and ticks because we&#39;re going to combine this</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>                title<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>                axis<span class="op">=</span>alt.Axis(</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>                    labels<span class="op">=</span><span class="va">False</span>, values<span class="op">=</span>[<span class="dv">0</span>], grid<span class="op">=</span><span class="va">False</span>, ticks<span class="op">=</span><span class="va">False</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>        .properties(height<span class="op">=</span><span class="dv">100</span>, width<span class="op">=</span><span class="dv">800</span>)</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Now create jitter plot of the same field</span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># jittering / stripplot adapted from https://stackoverflow.com/a/71902446/9706217</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>    chart_color_opts <span class="op">=</span> {}</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> color_opts <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>        chart_color_opts <span class="op">=</span> {<span class="st">&quot;color&quot;</span>: color_opts}</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>    stripplot <span class="op">=</span> (</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>        alt.Chart(dataset)</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>        .mark_circle(size<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>        .encode(</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>alt.X(</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>                fieldname,</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>                title<span class="op">=</span>field_label,</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>                axis<span class="op">=</span>alt.Axis(labels<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>alt.Y(<span class="st">&quot;jitter:Q&quot;</span>, title<span class="op">=</span><span class="va">None</span>, axis<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>chart_color_opts,</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>            <span class="co"># color=alt.Color(color_by),  # .scale(**color_scale),</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>        .transform_calculate(jitter<span class="op">=</span><span class="st">&quot;(random() / 200) - 0.0052&quot;</span>)</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>        .properties(</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>            height<span class="op">=</span><span class="dv">120</span>,</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>            width<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use vertical concat to combine the two plots together</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>    raincloud_plot <span class="op">=</span> alt.vconcat(duration_density, stripplot).configure_concat(</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>        spacing<span class="op">=</span><span class="dv">0</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> raincloud_plot</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>stein_borrows_plot <span class="op">=</span> raincloud_plot(</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>    stein_borrow_events_df,</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;undate_duration&quot;</span>,</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Borrow duration in days&quot;</span>,</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">&quot;known_year&quot;</span>, title<span class="op">=</span><span class="st">&quot;Year&quot;</span>),</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<h1 class="unnumbered" id="bibliography">References</h1>
<div id="refs" class="references csl-bib-body" data-entry-spacing="0"
role="list">
<div id="ref-koeser_undate_python_2025" class="csl-entry"
role="listitem">
<div class="csl-left-margin">[1] </div><div
class="csl-right-inline">Koeser RS, Crawford C, Damerow J, Vogl M,
Casties R. Undate python library 2025. <a
href="https://doi.org/10.5281/zenodo.11068867">https://doi.org/10.5281/zenodo.11068867</a>.</div>
</div>
<div id="ref-koeser_undate_2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div
class="csl-right-inline">Koeser RS, Damerow J, Casties R, Crawford C.
Undate: Humanistic dates for computation. Computational Humanities
Research 2025;1:e5. <a
href="https://doi.org/10.1017/chr.2025.10006">https://doi.org/10.1017/chr.2025.10006</a>.</div>
</div>
<div id="ref-koeser_join_2023" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div
class="csl-right-inline">Koeser RS. <a
href="https://dh-tech.github.io/blog/2023/02/09/hackathon-undate/">Join
me for a <span>DHTech</span> hackathon? <span>It</span>’s an
un-date!</a> DHTech 2023.</div>
</div>
<div id="ref-rustow_dating_2020" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div
class="csl-right-inline">Rustow M. <a
href="https://cdh.princeton.edu/blog/2020/11/18/dating-problems-ask-princeton-geniza-project-team/">Dating
<span>Problems</span>? <span>Ask</span> the <span>Princeton</span>
<span>Geniza</span> <span>Project</span> <span>Team</span></a>. The
Center for Digital Humanities at Princeton 2020.</div>
</div>
<div id="ref-rustow_princeton_2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div
class="csl-right-inline">Rustow M, Koeser RS, Richman R, Ryzhova K,
Bensalim A, Mohamed A. Princeton <span>Geniza</span>
<span>Project</span> <span>Dataset</span> 2025. <a
href="https://doi.org/10.5281/zenodo.15839055">https://doi.org/10.5281/zenodo.15839055</a>.</div>
</div>
<div id="ref-kotin_shakespeare_2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div
class="csl-right-inline">Kotin J, Koeser RS. Shakespeare and
<span>Company</span> <span>Project</span> <span>Data</span>
<span>Sets</span>. Journal of Cultural Analytics 2022;7. <a
href="https://doi.org/10.22148/001c.32551">https://doi.org/10.22148/001c.32551</a>.</div>
</div>
<div id="ref-koeser_coding_2019" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div
class="csl-right-inline">Koeser RS. <a
href="https://cdh.princeton.edu/blog/2019/12/05/coding-unknowns/">Coding
with <span>Unknowns</span></a>. Center for Digital Humanities at
Princeton University 2019.</div>
</div>
<div id="ref-stein_beachpapers_pul" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div><div
class="csl-right-inline">Beach S. Stein, gertrude; sylvia beach papers
n.d.</div>
</div>
<div id="ref-noauthor_gertrude_nodate" class="csl-entry"
role="listitem">
<div class="csl-left-margin">[9] </div><div class="csl-right-inline"><a
href="https://shakespeareandco.princeton.edu/members/stein-gertrude/">Gertrude
<span>Stein</span></a>. Shakespeare and Company Project n.d.</div>
</div>
<div id="ref-yau_visualizing_2018" class="csl-entry" role="listitem">
<div class="csl-left-margin">[10] </div><div
class="csl-right-inline">Yau N. <a
href="https://flowingdata.com/2018/01/08/visualizing-the-uncertainty-in-data/">Visualizing
the <span>Uncertainty</span> in <span>Data</span></a>. FlowingData
2018.</div>
</div>
<div id="ref-koeser_shakespeare_2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[11] </div><div
class="csl-right-inline">Koeser RS, Kotin J. <a
href="https://doi.org/10.34770/kf6c-b079">Shakespeare and
<span>Company</span> <span>Project</span> <span>Datasets</span></a>
2025.</div>
</div>
<div id="ref-koeser_missing_2024" class="csl-entry" role="listitem">
<div class="csl-left-margin">[12] </div><div
class="csl-right-inline">Koeser RS, LeBlanc Z. Missing
<span>Data</span>, <span>Speculative</span> <span>Reading</span>.
Journal of Cultural Analytics 2024;9. <a
href="https://doi.org/10.22148/001c.116926">https://doi.org/10.22148/001c.116926</a>.</div>
</div>
</div>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>https://github.com/dh-tech/undate-python/<a
href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>With the caveat that in this case the results are
somewhat skewed by the dates that can easily be parsed; PGP data
includes modifiers not yet supported by <code>undate</code>, which were
ignored during parsing.<a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Analysis and visualization adapted from prior work.
<span class="citation" data-cites="koeser_undate_2025">[<a
href="#ref-koeser_undate_2025" role="doc-biblioref">2</a>]</span><a
href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Stein is famous enough that these unknowns could perhaps
be resolved through research; that is not the case for the lesser known
members of this library.<a href="#fnref4" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="content has-text-centered">
      <p>
        <strong>Anthology of Computers and the Humanities</strong> · Association for Computers and the Humanities
      </p>
      <p class="is-size-7">
        Paper © 2025 the authors. All other content © 2025 ACH.
      </p>
    </div>
  </footer>

  
  <script>
    // Navbar burger menu functionality
    document.addEventListener('DOMContentLoaded', () => {
      // Get all "navbar-burger" elements
      const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
    
      // Add a click event on each of them
      $navbarBurgers.forEach( el => {
        el.addEventListener('click', () => {
          // Get the target from the "data-target" attribute
          const target = el.dataset.target;
          const $target = document.getElementById(target);
    
          // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
          el.classList.toggle('is-active');
          $target.classList.toggle('is-active');
        });
      });
    });
  </script>

  <!-- Lightbox JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>

  <!-- Prism.js for syntax highlighting -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-xml.min.js"></script>

  <script>
    // Configure Lightbox
    lightbox.option({
      'resizeDuration': 200,
      'wrapAround': true,
      'albumLabel': 'Image %1 of %2',
      'fadeDuration': 300,
      'imageFadeDuration': 300
    });

    // Add copy buttons to code blocks
    document.addEventListener('DOMContentLoaded', function() {
      // Find all code blocks (both .sourceCode and figure-wrapped ones)
      const codeBlocks = document.querySelectorAll('div.sourceCode, div.float-body.listing');

      // SVG icons
      const copyIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>';
      const checkIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/></svg>';

      codeBlocks.forEach(function(block) {
        // Create copy button
        const button = document.createElement('button');
        button.className = 'code-copy-button';
        button.innerHTML = copyIcon;
        button.setAttribute('aria-label', 'Copy code to clipboard');
        button.setAttribute('title', 'Copy code');

        // Add click handler
        button.addEventListener('click', function() {
          // Get the code content
          const code = block.querySelector('code');
          const text = code.textContent;

          // Copy to clipboard
          navigator.clipboard.writeText(text).then(function() {
            // Show success feedback
            button.innerHTML = checkIcon;
            button.classList.add('copied');
            button.setAttribute('title', 'Copied!');

            // Reset button after 2 seconds
            setTimeout(function() {
              button.innerHTML = copyIcon;
              button.classList.remove('copied');
              button.setAttribute('title', 'Copy code');
            }, 2000);
          }).catch(function(err) {
            console.error('Failed to copy text: ', err);
            button.innerHTML = '✕';
            setTimeout(function() {
              button.innerHTML = copyIcon;
            }, 2000);
          });
        });

        // Insert button into the code block container
        block.appendChild(button);
      });

      // Re-run Prism highlighting if needed
      if (typeof Prism !== 'undefined') {
        Prism.highlightAll();
      }
    });
  </script>

</body>
</html>